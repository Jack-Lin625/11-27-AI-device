<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>OOOOO Light Coach - On-Device AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#020617" />
  <style>
    :root {
      --bg: #020617;
      --bg-alt: #0b1120;
      --card: #020617;
      --accent: #38bdf8;
      --accent-strong: #0ea5e9;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.4);
      --radius-xl: 1.25rem;
      --radius-lg: 1rem;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.85);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #0f172a 0, #020617 40%, #000 100%);
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      color: var(--text-main);
      height: 100%;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      padding: 12px 12px 80px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* Header */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border-radius: var(--radius-xl);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.9));
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: var(--shadow-soft);
      position: sticky;
      top: 8px;
      z-index: 10;
      backdrop-filter: blur(18px);
    }

    .logo-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-orb {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: conic-gradient(from 180deg, #38bdf8, #22c55e, #a855f7, #38bdf8);
      padding: 2px;
    }

    .logo-orb-inner {
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background: radial-gradient(circle at 30% 20%, #f9fafb, #0f172a);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .logo-title {
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-size: 13px;
    }

    .logo-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .badge-pill {
      padding: 6px 10px;
      border-radius: var(--radius-pill);
      background: rgba(15, 23, 42, 0.94);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-sub);
      white-space: nowrap;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #f97316;
      box-shadow: 0 0 10px rgba(248, 113, 113, 0.9);
      transition: all 0.2s ease;
    }

    .dot.ok {
      background: #4ade80;
      box-shadow: 0 0 10px rgba(74, 222, 128, 0.9);
    }

    .badge-pill span.status-text {
      font-weight: 500;
    }

    .badge-pill .chip {
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 10px;
      color: var(--accent);
    }

    /* Layout */
    .main {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .section-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-sub);
      padding: 0 4px;
      margin-top: 3px;
    }

    .card {
      background: radial-gradient(circle at top left, #111827, #020617 55%);
      border-radius: var(--radius-xl);
      padding: 14px 14px 12px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.9);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title span.icon {
      font-size: 18px;
    }

    .card-desc {
      font-size: 12px;
      color: var(--text-sub);
      line-height: 1.5;
      margin-bottom: 10px;
    }

    .pill-label {
      font-size: 10px;
      padding: 4px 8px;
      border-radius: var(--radius-pill);
      background: rgba(15, 23, 42, 0.94);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill-label span.dot-tiny {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-radius: var(--radius-pill);
      border: none;
      outline: none;
      padding: 9px 16px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: radial-gradient(circle at top left, var(--accent-strong), var(--accent));
      color: #0f172a;
      box-shadow: 0 10px 24px rgba(56, 189, 248, 0.55);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.9);
      filter: brightness(0.96);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.96);
      color: var(--text-main);
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: none;
    }

    .btn-full {
      width: 100%;
      justify-content: center;
    }

    .btn-small {
      padding: 7px 14px;
      font-size: 12px;
    }

    .btn-icon {
      font-size: 15px;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .row-space {
      justify-content: space-between;
    }

    /* Camera */
    .camera-wrap {
      border-radius: var(--radius-lg);
      border: 1px dashed rgba(148, 163, 184, 0.8);
      background: radial-gradient(circle at top, #0f172a, #020617);
      overflow: hidden;
      margin-bottom: 8px;
    }

    .camera-inner {
      position: relative;
      padding: 10px;
    }

    video {
      width: 100%;
      border-radius: 14px;
      background: #020617;
      display: block;
    }

    .camera-overlay {
      position: absolute;
      inset: 10px;
      border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.7);
      pointer-events: none;
    }

    .camera-label {
      position: absolute;
      left: 16px;
      top: 14px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.94);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .camera-label .bulb {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #f97316;
      box-shadow: 0 0 8px rgba(249, 115, 22, 0.9);
      transition: all 0.2s ease;
    }

    .camera-status {
      position: absolute;
      bottom: 14px;
      left: 16px;
      right: 16px;
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--text-sub);
    }

    /* Result */
    .light-result {
      margin-top: 4px;
      border-radius: 14px;
      padding: 9px 10px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .light-icon {
      font-size: 24px;
      flex-shrink: 0;
    }

    .light-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .light-title {
      font-size: 13px;
      font-weight: 600;
    }

    .light-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .light-meta {
      font-size: 10px;
      color: #a5b4fc;
      margin-top: 3px;
    }

    .hint {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 8px;
      line-height: 1.5;
    }

    .badge-mini {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      color: var(--text-sub);
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.98);
    }

    .badge-mini .mini-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .offline-hint {
      font-size: 11px;
      color: var(--text-sub);
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
    }

    .offline-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #f97316;
      box-shadow: 0 0 8px rgba(249, 115, 22, 0.8);
      transition: all 0.2s ease;
    }

    .offline-hint.ok .offline-dot {
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.9);
    }

    .offline-hint strong {
      color: #e5e7eb;
    }

    /* Idea section */
    .idea-display {
      margin-top: 8px;
      border-radius: 14px;
      border: 1px dashed rgba(148, 163, 184, 0.8);
      padding: 10px 10px 8px;
      background: rgba(15, 23, 42, 0.98);
      font-size: 12px;
      line-height: 1.6;
      position: relative;
      overflow: hidden;
    }

    .idea-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .idea-main {
      font-size: 13px;
    }

    .idea-tag {
      margin-top: 4px;
      font-size: 10px;
      color: var(--text-sub);
    }

    .idea-glow {
      position: absolute;
      width: 120px;
      height: 120px;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(56, 189, 248, 0.22), transparent 70%);
      right: -40px;
      bottom: -60px;
      pointer-events: none;
    }

    /* Bottom nav */
    .bottom-nav {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      justify-content: center;
      pointer-events: none;
      padding: 0 12px 10px;
    }

    .bottom-nav-inner {
      width: 100%;
      max-width: 480px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 6px 10px;
      pointer-events: auto;
      backdrop-filter: blur(18px);
    }

    .nav-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      font-size: 10px;
      color: var(--text-sub);
      background: none;
      border: none;
      padding: 3px 4px;
    }

    .nav-icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.8);
    }

    .nav-btn.active {
      color: var(--accent);
    }

    .nav-btn.active .nav-icon {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.45);
    }

    /* Hide canvas */
    #frameCanvas {
      display: none;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="app-header">
      <div class="logo-wrap">
        <div class="logo-orb">
          <div class="logo-orb-inner">ğŸ”†</div>
        </div>
        <div class="logo-text">
          <div class="logo-title">OOOOO</div>
          <div class="logo-sub">Light Coach Â· On-Device AI</div>
        </div>
      </div>
      <div class="badge-pill" id="modelStatus">
        <span class="dot" id="modelDot"></span>
        <span class="status-text">è¼‰å…¥æ¨¡å‹ä¸­â€¦</span>
        <span class="chip">On-Device</span>
      </div>
    </header>

    <main class="main">
      <div class="section-title">Playground</div>

      <!-- ä¸»å¡ç‰‡ï¼šå…‰ç·š â†’ æ´»å‹•å»ºè­° -->
      <section class="card" id="section-main">
        <div class="card-header">
          <div class="card-title">
            <span class="icon">ğŸ“±</span>
            <span>æ ¹æ“šå…‰ç·šåˆ¤æ–·é©åˆåšä»€éº¼</span>
          </div>
          <div class="pill-label">
            <span class="dot-tiny"></span>
            <span>äº®åº¦å°æ¨¡å‹ Â· å…¨åœ¨è£ç½®ä¸Šè·‘</span>
          </div>
        </div>
        <p class="card-desc">
          é–‹å•Ÿå‰é¡é ­ï¼ŒOOOOO æœƒè®€å–ç•«é¢çš„å…‰ç·šäº®åº¦ï¼Œåœ¨ä½ çš„æ‰‹æ©Ÿä¸Šç›´æ¥åšæ¨è«–ï¼Œ
          å‘Šè¨´ä½ ç¾åœ¨çš„ç’°å¢ƒæ¯”è¼ƒé©åˆ <strong>è®€æ›¸ã€ç©éŠæˆ²ã€é‚„æ˜¯ç¡è¦º</strong>ã€‚
          åœ–åƒä¸æœƒä¸Šå‚³ï¼Œæ‰€æœ‰è¨ˆç®—éƒ½ç•™åœ¨ä½ çš„è£ç½®è£¡ã€‚
        </p>

        <div class="camera-wrap">
          <div class="camera-inner">
            <video id="camera" playsinline autoplay muted></video>
            <div class="camera-overlay"></div>
            <div class="camera-label">
              <span class="bulb" id="camBulb"></span>
              <span id="camLabelText">ç›¸æ©Ÿæœªå•Ÿå‹•</span>
            </div>
            <div class="camera-status">
              <span id="cameraHint">æŒ‰ä¸‹ã€Œå•Ÿå‹•ç›¸æ©Ÿã€ä¸¦æŠŠæ‰‹æ©Ÿæ”¾åœ¨ç¾åœ¨çš„ç’°å¢ƒä½ç½®ã€‚</span>
              <span id="cameraEnv">å…‰ç·šåµæ¸¬ï¼šâ€”</span>
            </div>
          </div>
        </div>

        <div class="row row-space" style="margin-bottom: 4px;">
          <button class="btn btn-small" id="btnInitCamera">
            <span class="btn-icon">ğŸ“·</span>
            å•Ÿå‹•å‰é¡é ­
          </button>
          <button class="btn btn-secondary btn-small" id="btnAnalyze">
            <span class="btn-icon">ğŸ”®</span>
            åˆ†æå…‰ç·šï¼Œçµ¦å»ºè­°
          </button>
        </div>

        <div class="light-result" id="lightResult">
          <div class="light-icon" id="lightIcon">ğŸ¤”</div>
          <div class="light-info">
            <div class="light-title" id="lightTitle">ç­‰å¾…åˆ†æä¸­</div>
            <div class="light-sub" id="lightSub">
              é–‹å•Ÿç›¸æ©Ÿå¾ŒæŒ‰ã€Œåˆ†æå…‰ç·šã€ï¼ŒOOOOO æœƒæ ¹æ“šäº®åº¦å¹«ä½ é¸ï¼šè®€æ›¸ / ç©éŠæˆ² / ç¡è¦º / æ”¾é¬†ã€‚
            </div>
            <div class="light-meta" id="lightMeta">å¹³å‡äº®åº¦ï¼šâ€”</div>
          </div>
        </div>

        <div class="offline-hint" id="offlineHint">
          <span class="offline-dot"></span>
          <span>
            <strong>é›¢ç·šæé†’ï¼š</strong>æ¨¡å‹è¼‰å…¥å®Œæˆå¾Œï¼Œå³ä½¿é–‹é£›èˆªæ¨¡å¼ï¼Œé€™å€‹å…‰ç·šåˆ¤æ–·åŠŸèƒ½ä»ç„¶å¯ç”¨ã€‚
          </span>
        </div>

        <div class="hint">
          æŠ€è¡“å‚™è¨»ï¼šé€™è£¡çš„ã€Œäº®åº¦æ¨¡å‹ã€å…¶å¯¦æ˜¯ä¸€å€‹å°å°çš„è¦å‰‡æ¨¡å‹ï¼ˆè¨ˆç®—ç•«é¢å¹³å‡äº®åº¦ã€åŠ ä¸Šä¸€é»é‚è¼¯åˆ¤æ–·ï¼‰ï¼Œ
          ä½†å¯¦ä½œæ–¹å¼è·ŸçœŸæ­£çš„ on-device AI æ¨¡å‹å¾ˆåƒ â€”â€” å½±åƒåœ¨æœ¬åœ°å–æ¨£ã€ç‰¹å¾µåœ¨æœ¬åœ°è¨ˆç®—ã€çµæœåœ¨æœ¬åœ°ç”¢ç”Ÿã€‚
        </div>

        <!-- éš±è—ç”¨ä¾†å–æ¨£çš„ canvas -->
        <canvas id="frameCanvas"></canvas>
      </section>

      <!-- Idea / æ“´å……æƒ³æ³• -->
      <section class="card" id="section-idea">
        <div class="card-header">
          <div class="card-title">
            <span class="icon">ğŸ’¡</span>
            <span>æœªä¾†å¯ä»¥æ€éº¼æ“´å…… OOOOOï¼Ÿ</span>
          </div>
          <div class="pill-label">
            <span class="dot-tiny"></span>
            <span>On-Device Lab</span>
          </div>
        </div>
        <p class="card-desc">
          é€™å€‹ç¶²é ç¾åœ¨åªç¤ºç¯„ã€Œå…‰ç·šäº®åº¦ â†’ æ´»å‹•å»ºè­°ã€ï¼Œ
          ä½†åŒæ¨£çš„ on-device æµç¨‹ï¼Œå¯ä»¥æ“´å……æ›´å¤š AI åŠŸèƒ½ï¼Œè€Œä¸”å…¨éƒ¨å¯ä»¥é›¢ç·šé‹ä½œã€‚
        </p>

        <button class="btn btn-full btn-small" id="btnIdea">
          <span class="btn-icon">ğŸ²</span>
          çµ¦æˆ‘ä¸€å€‹æ–°çš„ OOOOO åŠŸèƒ½é»å­
        </button>

        <div class="idea-display" id="ideaDisplay">
          <div class="idea-label">IDEA Â· EXAMPLE</div>
          <div class="idea-main" id="ideaMain">
            ã€Œå…‰ç·š + ä½¿ç”¨æ™‚é–“ã€ä¸€èµ·åˆ†æï¼šå¤ªäº®åˆå¤ªæ™šï¼Œå°±æé†’ä½ è©²ä¼‘æ¯çœ¼ç›ï¼›å¤ªæš—åˆæ‰“éŠæˆ²ï¼Œå°±å»ºè­°é–‹ç‡ˆé¿å…å‚·çœ¼ã€‚
          </div>
          <div class="idea-tag" id="ideaTag">#æ•¸ä½å¥åº· #OnDeviceAI #LightCoach</div>
          <div class="idea-glow"></div>
        </div>

        <div class="hint">
          æƒ³åšçœŸæ­£çš„æ¨¡å‹æ™‚ï¼Œåªè¦æŠŠç¾åœ¨é€™å€‹äº®åº¦è¦å‰‡å‡½å¼æ›æˆ
          <span class="badge-mini">
            <span class="mini-dot"></span> WebGPU / WebAssembly / TensorFlow.js
          </span>
          ç­‰ç­‰å°±å¯ä»¥ã€‚
        </div>
      </section>
    </main>

    <!-- Bottom Nav -->
    <nav class="bottom-nav">
      <div class="bottom-nav-inner">
        <button class="nav-btn active" data-target="section-main">
          <div class="nav-icon">ğŸ”†</div>
          <div>å…‰ç·šå»ºè­°</div>
        </button>
        <button class="nav-btn" data-target="section-idea">
          <div class="nav-icon">ğŸ§ª</div>
          <div>æ“´å……é»å­</div>
        </button>
      </div>
    </nav>
  </div>

  <script>
    // ===== æ¨¡å‹è¼‰å…¥ç‹€æ…‹ï¼ˆæ¨¡æ“¬ On-Device æ¨¡å‹åˆå§‹åŒ–ï¼‰ =====
    const modelStatusEl = document.getElementById("modelStatus");
    const modelDotEl = document.getElementById("modelDot");
    const offlineHintEl = document.getElementById("offlineHint");

    function markModelLoaded() {
      modelDotEl.classList.add("ok");
      modelStatusEl.querySelector(".status-text").textContent = "æ¨¡å‹å·²è¼‰å…¥ (On-Device)";
      offlineHintEl.classList.add("ok");
    }

    // æ¨¡æ“¬è¼‰å…¥æ™‚é–“ï¼šä¹‹å¾Œå¯æ”¹æˆçœŸæ­£æ¨¡å‹è¼‰å…¥å®Œæˆå¾Œå‘¼å«
    setTimeout(markModelLoaded, 1200);

    // ===== ç›¸æ©Ÿ + äº®åº¦å°æ¨¡å‹ =====
    const cameraEl = document.getElementById("camera");
    const btnInitCamera = document.getElementById("btnInitCamera");
    const btnAnalyze = document.getElementById("btnAnalyze");
    const cameraHintEl = document.getElementById("cameraHint");
    const cameraEnvEl = document.getElementById("cameraEnv");
    const camBulbEl = document.getElementById("camBulb");
    const camLabelTextEl = document.getElementById("camLabelText");
    const frameCanvas = document.getElementById("frameCanvas");

    const lightIconEl = document.getElementById("lightIcon");
    const lightTitleEl = document.getElementById("lightTitle");
    const lightSubEl = document.getElementById("lightSub");
    const lightMetaEl = document.getElementById("lightMeta");

    let cameraStream = null;

    async function initCamera() {
      try {
        cameraStream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: "environment", // å„ªå…ˆç”¨å¾Œé¡é ­é‡ç’°å¢ƒ
            width: { ideal: 640 },
            height: { ideal: 480 }
          },
          audio: false
        });
        cameraEl.srcObject = cameraStream;
        camBulbEl.style.background = "#22c55e";
        camBulbEl.style.boxShadow = "0 0 8px rgba(34, 197, 94, 0.9)";
        camLabelTextEl.textContent = "ç›¸æ©Ÿå·²å•Ÿå‹•";
        cameraHintEl.textContent = "æŠŠæ‰‹æ©Ÿæ”¾åœ¨ä½ å¹³å¸¸ä½¿ç”¨çš„ä½ç½®ï¼Œè®“é¡é ­çœ‹åˆ°ç’°å¢ƒå…‰ç·šã€‚";
      } catch (err) {
        console.error(err);
        camBulbEl.style.background = "#ef4444";
        camBulbEl.style.boxShadow = "0 0 8px rgba(239, 68, 68, 0.9)";
        camLabelTextEl.textContent = "ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿ";
        cameraHintEl.textContent = "è«‹ç¢ºèªå·²å…è¨±ç›¸æ©Ÿæ¬Šé™ï¼Œæˆ–åœ¨ç€è¦½å™¨è¨­å®šä¸­é–‹å•Ÿé¡é ­ã€‚";
      }
    }

    function computeAverageBrightness(imageData) {
      const data = imageData.data;
      let sum = 0;
      const step = 4 * 8; // é–“éš”å–æ¨£ï¼ŒåŠ é€Ÿé‹ç®—
      let count = 0;

      for (let i = 0; i < data.length; i += step) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];
        const brightness = (r + g + b) / 3;
        sum += brightness;
        count++;
      }
      return count ? sum / count : 0;
    }

    // æ ¸å¿ƒï¼šåœ¨è£ç½®ä¸Šæ ¹æ“šäº®åº¦åšã€Œè¡Œç‚ºå»ºè­°ã€
    function runOnDeviceLightModel(avgBrightness) {
      // 0 ~ 255
      let suggestion = {
        icon: "ğŸ¤”",
        title: "äº®åº¦è³‡è¨Šä¸è¶³",
        sub: "å†è®“é¡é ­çœ‹ä¸€ä¸‹ç’°å¢ƒï¼Œæˆ–ç¨å¾®ç§»å‹•ä¸€ä¸‹æ‰‹æ©Ÿã€‚",
        meta: `å¹³å‡äº®åº¦ï¼šç´„ ${avgBrightness.toFixed(0)}`
      };

      if (avgBrightness >= 180) {
        suggestion.icon = "ğŸ“š";
        suggestion.title = "è¶…é©åˆè®€æ›¸ / å°ˆå¿ƒå·¥ä½œ";
        suggestion.sub = "ç’°å¢ƒéå¸¸æ˜äº®ï¼Œå°å°ˆæ³¨èˆ‡æ¸…é†’å¾ˆåŠ åˆ†ã€‚è¨˜å¾—é¿å…è¢å¹•å¤ªäº®ç›´å°„çœ¼ç›ã€‚";
      } else if (avgBrightness >= 130 && avgBrightness < 180) {
        suggestion.icon = "ğŸ®";
        suggestion.title = "å¾ˆé©åˆç©éŠæˆ² / çœ‹å½±ç‰‡";
        suggestion.sub = "å…‰ç·šåä¸­ç­‰ï¼Œè¢å¹•ä¸æœƒå¤ªåˆºçœ¼ï¼Œä¹Ÿä¸è‡³æ–¼å¤ªæš—ï¼Œå¯ä»¥ç•¶ä½œ Chill æ¨¡å¼ã€‚";
      } else if (avgBrightness >= 90 && avgBrightness < 130) {
        suggestion.icon = "â˜•";
        suggestion.title = "å¾®æš—ç’°å¢ƒ Â· é©åˆæ”¾é¬† / æ»‘æ‰‹æ©Ÿ";
        suggestion.sub = "äº®åº¦æœ‰é»åæš—ï¼Œé•·æ™‚é–“è®€æ›¸å®¹æ˜“æƒ³ç¡ï¼Œå¯ä»¥ç•¶æ”¾é¬†ã€è½æ­Œã€æ»‘ IG çš„ç©ºé–“ã€‚";
      } else if (avgBrightness >= 50 && avgBrightness < 90) {
        suggestion.icon = "ğŸ˜´";
        suggestion.title = "åæš— Â· å¾ˆé©åˆæº–å‚™ç¡è¦º";
        suggestion.sub = "ç’°å¢ƒå·²ç¶“å¾ˆæš—äº†ï¼Œå¤§è…¦æœƒæ…¢æ…¢é€²å…¥æƒ³ç¡ç‹€æ…‹ã€‚å¯ä»¥é—œè¢å¹•ä¼‘æ¯ä¸€ä¸‹ã€‚";
      } else {
        suggestion.icon = "ğŸŒ™";
        suggestion.title = "å¹¾ä¹å…¨æš— Â· æ·±å¤œç¡çœ æ¨¡å¼";
        suggestion.sub = "é€™å€‹äº®åº¦å†ç›¯è¢å¹•å¾ˆå‚·çœ¼ã€‚å»ºè­°ç›´æ¥èººå¹³ç¡è¦ºï¼Œæ˜å¤©ç²¾ç¥æœƒæ›´å¥½ã€‚";
      }

      suggestion.meta = `å¹³å‡äº®åº¦ï¼šç´„ ${avgBrightness.toFixed(0)}ï¼ˆ0 æš— ~ 255 äº®ï¼‰`;
      return suggestion;
    }

    function analyzeLight() {
      if (!cameraEl.videoWidth || !cameraEl.videoHeight) {
        lightIconEl.textContent = "âš ï¸";
        lightTitleEl.textContent = "å°šæœªå–å¾—ç•«é¢";
        lightSubEl.textContent = "è«‹å…ˆå•Ÿå‹•ç›¸æ©Ÿï¼Œç­‰ç•«é¢å‡ºç¾å¾Œå†æŒ‰ä¸€æ¬¡åˆ†æã€‚";
        lightMetaEl.textContent = "å¹³å‡äº®åº¦ï¼šâ€”";
        return;
      }

      const sampleWidth = 120;
      const sampleHeight = 90;

      frameCanvas.width = sampleWidth;
      frameCanvas.height = sampleHeight;

      const ctx = frameCanvas.getContext("2d");
      ctx.drawImage(
        cameraEl,
        (cameraEl.videoWidth - sampleWidth) / 2,
        (cameraEl.videoHeight - sampleHeight) / 2,
        sampleWidth,
        sampleHeight,
        0,
        0,
        sampleWidth,
        sampleHeight
      );

      const imageData = ctx.getImageData(0, 0, sampleWidth, sampleHeight);
      const avgBrightness = computeAverageBrightness(imageData);

      const suggestion = runOnDeviceLightModel(avgBrightness);

      lightIconEl.textContent = suggestion.icon;
      lightTitleEl.textContent = suggestion.title;
      lightSubEl.textContent = suggestion.sub;
      lightMetaEl.textContent = suggestion.meta;

      // é¡¯ç¤ºç°¡å–®çš„ã€Œå…‰ç·šç‹€æ…‹ã€
      let envText = "å…‰ç·šåµæ¸¬ï¼š";
      if (avgBrightness >= 180) envText += "éå¸¸æ˜äº®";
      else if (avgBrightness >= 130) envText += "ä¸­ç­‰åäº®";
      else if (avgBrightness >= 90) envText += "åæš—";
      else envText += "å¾ˆæš—";
      cameraEnvEl.textContent = envText;
    }

    btnInitCamera.addEventListener("click", initCamera);
    btnAnalyze.addEventListener("click", analyzeLight);

    // ===== Bottom Navï¼ˆå¦‚æœä¹‹å¾Œè¦å¤šé ï¼‰ =====
    const navButtons = document.querySelectorAll(".nav-btn");
    navButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        navButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        const targetId = btn.getAttribute("data-target");
        document.querySelectorAll("section.card").forEach(sec => {
          sec.style.display = sec.id === targetId ? "block" : "block"; // ç›®å‰åªæœ‰å…©å€‹ sectionï¼Œéƒ½ä¿ç•™é¡¯ç¤º
        });
      });
    });

    // ===== Idea generatorï¼šç”¢ç”Ÿæ–°çš„ OOOOO åŠŸèƒ½æƒ³æ³• =====
    const btnIdea = document.getElementById("btnIdea");
    const ideaMainEl = document.getElementById("ideaMain");
    const ideaTagEl = document.getElementById("ideaTag");

    const ideas = [
      {
        text: "çµåˆã€Œå…‰ç·š + éº¥å…‹é¢¨éŸ³é‡ã€ï¼šåµæ¸¬ä½ æ˜¯ä¸æ˜¯åœ¨åµé›œç’°å¢ƒè®€æ›¸ï¼Œå¦‚æœå¤ªåµå°±å»ºè­°æˆ´è€³æ©Ÿæˆ–æ›åœ°æ–¹ã€‚",
        tag: "#å°ˆæ³¨æ¨¡å¼ #ç’°å¢ƒå™ªéŸ³ #LightCoach"
      },
      {
        text: "åšä¸€å€‹ã€Œ24 å°æ™‚å…‰ç·šæ—¥è¨˜ã€ï¼šå…¨å¤©è¢«å‹•è¨˜éŒ„äº®åº¦è®ŠåŒ–ï¼Œå¹«ä½ åˆ†æåˆ°åº•å“ªä¸€æ®µæ™‚é–“æœ€é©åˆè®€æ›¸ã€‚",
        tag: "#å…‰ç·šæ—¥è¨˜ #å­¸ç¿’é»ƒé‡‘æ™‚æ®µ"
      },
      {
        text: "æ™šä¸Šè‡ªå‹•åˆ‡æ›ã€Œè­·çœ¼æ¨¡å¼ã€ï¼šåªè¦åµæ¸¬åˆ°ç’°å¢ƒå¾ˆæš—å»è¢å¹•å¾ˆäº®ï¼Œå°±æé†’ä½ èª¿ä½äº®åº¦æˆ–é–‹ç‡ˆã€‚",
        tag: "#è­·çœ¼ #å¤œè²“å­å®ˆè­·ç¨‹å¼"
      },
      {
        text: "æŠŠäº®åº¦è³‡æ–™åšæˆã€Œç”Ÿæ´»å„€è¡¨æ¿ã€ï¼šç™½å¤©å¤ªæš—ã€æ™šä¸Šå¤ªäº®éƒ½æœƒè¢«æ¨™è¨˜å‡ºä¾†ï¼Œå¹«ä½ èª¿æ•´ä½œæ¯ã€‚",
        tag: "#ç”Ÿæ´»å„€è¡¨æ¿ #å¥åº·å…‰ç·š"
      },
      {
        text: "çµåˆæ™‚é–“è¡¨ï¼šåœ¨ä½ æ’å¥½çš„è®€æ›¸æ™‚æ®µï¼Œå¦‚æœäº®åº¦ä¸ç†æƒ³ï¼Œå°±æé†’ä½ èª¿æ•´ç‡ˆå…‰ï¼Œé¿å…åˆ†å¿ƒæˆ–æƒ³ç¡ã€‚",
        tag: "#è®€æ›¸è¨ˆç•« #LightCoach"
      }
    ];

    btnIdea.addEventListener("click", () => {
      const idx = Math.floor(Math.random() * ideas.length);
      ideaMainEl.textContent = ideas[idx].text;
      ideaTagEl.textContent = ideas[idx].tag;
    });
  </script>
</body>
</html>
